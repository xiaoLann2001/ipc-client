### 视频模块设计

### 视频流解码模块`VideoStreamDecoder`
- 功能：
    - 基于`ffmpeg`开源音视频库的音视频解码线程类
    - 根据输入的url获取音视频流信息，提供获取音视频流信息方法
    - 继承`QThread`线程类，循环解码音视频流，并将结果存入缓存队列，并用信号通知上一层视频帧可获取
    - 为每一个视频流创建一个`VideoStreamInfo`类，用于存放视频流基本信息
    - 公共方法：
        - `pause()`
            - 暂停解码
        - `stop()`
            - 停止编码线程并释放资源
        - `VideoStreamInfo* getVideoStreamInfo()`
            - 获取视频的基本信息
        - `QImage getDecodedFrame();`
            - 获取解码后的帧

### 视频流管理模块`VideoStreamManager`
- 功能：
    - 用`QMap`存放视频流句柄和`VideoStreamDecoder*`，句柄为键，视频流解码线程类为值
    - 捕获视频解码模块的信号，向上传递视频帧可获取信号及对应解码器句柄
    - 公共方法：
        - `int createVideoStream(const QString &url);`
            - 接收创建视频流的信号（带url），创建`VideoStreamControlInfo`类，返回视频流句柄
        - `void stopVideoStream(int handle);` 
            - 接收停止视频流的信号（带视频流句柄），调用`VideoStreamDecoder`的`stop()`方法
        - `VideoStreamInfo* getVideoStreamInfo(int handle);`
            - 根据视频编码器句柄，获取视频流信息
        - `QImage getDecodedFrame(int handle);`
            - 根据视频编码器句柄，获取解码后的帧

### 视频网格视图设计
- 需求：
    - 支持控件池以提高性能
    - 支持视频播放控件，能够设置图像，播放，暂停和停止
    - 支持悬浮窗控件，复制接收用户的控制，悬浮窗自动监视视频控件大小以调整自身大小
    - 支持动态网格数切换，视频显示控件自动填充
    - 支持翻页显示，网格数切换或视频数超出当前页，添加页数使添加的视频都能正确显示
    - 支持视频显示控件的选中与取消，以选中框的形式
    - 支持双击视频控件实现最大化/复原
    - 支持定时器调度重绘，避免过多的重绘事件产生，如
        - 25fps视频流，1个窗口播放时，每秒重绘数 25
        - 25fps视频流，2个窗口播放时，每秒重绘数 50
        - 25fps视频流，3个窗口播放时，每秒重绘数 60~75
        - 25fps视频流，4个窗口播放时，每秒重绘数 70~90

- 实现：
    - 编写控件池模板类，简化控件的获取和释放，避免控件频繁的创建与销毁
    - 编写视频播放单元类，复制视频显示
    - 编写悬浮窗类，显示视频信息与接收用户控制
    - 重写视频网格绘图事件，手动绘制背景，网格线，选中，最大化等效果

